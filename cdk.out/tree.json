{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.233.0"},"children":{"ChatWebSocketStack-prod":{"id":"ChatWebSocketStack-prod","path":"ChatWebSocketStack-prod","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.233.0"},"children":{"AppSecrets":{"id":"AppSecrets","path":"ChatWebSocketStack-prod/AppSecrets","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"ChatConnections":{"id":"ChatConnections","path":"ChatWebSocketStack-prod/ChatConnections","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"ChatWebSocketStack-prod/ChatConnections/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"connectionId","attributeType":"S"},{"attributeName":"visibleConversationId","attributeType":"S"},{"attributeName":"userId","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","globalSecondaryIndexes":[{"indexName":"ConversationIndex","keySchema":[{"attributeName":"visibleConversationId","keyType":"HASH"}],"projection":{"projectionType":"ALL"}},{"indexName":"UserIndex","keySchema":[{"attributeName":"userId","keyType":"HASH"}],"projection":{"projectionType":"ALL"}}],"keySchema":[{"attributeName":"connectionId","keyType":"HASH"}],"tableName":"ChatConnections-prod","timeToLiveSpecification":{"attributeName":"ttl","enabled":true}}}},"ScalingRole":{"id":"ScalingRole","path":"ChatWebSocketStack-prod/ChatConnections/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}}}},"Notifications":{"id":"Notifications","path":"ChatWebSocketStack-prod/Notifications","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"ChatWebSocketStack-prod/Notifications/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"userId","attributeType":"S"},{"attributeName":"timestamp","attributeType":"S"},{"attributeName":"id","attributeType":"S"},{"attributeName":"unread","attributeType":"S"},{"attributeName":"type","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","globalSecondaryIndexes":[{"indexName":"ByIdIndex","keySchema":[{"attributeName":"id","keyType":"HASH"}],"projection":{"projectionType":"ALL"}},{"indexName":"UnreadIndex","keySchema":[{"attributeName":"userId","keyType":"HASH"},{"attributeName":"unread","keyType":"RANGE"}],"projection":{"projectionType":"ALL"}},{"indexName":"TypeIndex","keySchema":[{"attributeName":"userId","keyType":"HASH"},{"attributeName":"type","keyType":"RANGE"}],"projection":{"projectionType":"ALL"}}],"keySchema":[{"attributeName":"userId","keyType":"HASH"},{"attributeName":"timestamp","keyType":"RANGE"}],"tableName":"Notifications-prod","timeToLiveSpecification":{"attributeName":"ttl","enabled":true}}}},"ScalingRole":{"id":"ScalingRole","path":"ChatWebSocketStack-prod/Notifications/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}}}},"PushSubscriptions":{"id":"PushSubscriptions","path":"ChatWebSocketStack-prod/PushSubscriptions","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"ChatWebSocketStack-prod/PushSubscriptions/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"userId","attributeType":"S"},{"attributeName":"endpoint","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","keySchema":[{"attributeName":"userId","keyType":"HASH"},{"attributeName":"endpoint","keyType":"RANGE"}],"tableName":"PushSubscriptions-prod","timeToLiveSpecification":{"attributeName":"ttl","enabled":true}}}},"ScalingRole":{"id":"ScalingRole","path":"ChatWebSocketStack-prod/PushSubscriptions/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}}}},"WebSocketLambdaRole":{"id":"WebSocketLambdaRole","path":"ChatWebSocketStack-prod/WebSocketLambdaRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.233.0","metadata":[]},"children":{"ImportWebSocketLambdaRole":{"id":"ImportWebSocketLambdaRole","path":"ChatWebSocketStack-prod/WebSocketLambdaRole/ImportWebSocketLambdaRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"Resource":{"id":"Resource","path":"ChatWebSocketStack-prod/WebSocketLambdaRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"ChatWebSocketStack-prod/WebSocketLambdaRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"ChatWebSocketStack-prod/WebSocketLambdaRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["dynamodb:BatchGetItem","dynamodb:Query","dynamodb:GetItem","dynamodb:Scan","dynamodb:ConditionCheckItem","dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["ChatConnectionsFC8BD7F3","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["ChatConnectionsFC8BD7F3","Arn"]},"/index/*"]]}]},{"Action":["dynamodb:GetRecords","dynamodb:GetShardIterator"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["ChatConnectionsFC8BD7F3","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["ChatConnectionsFC8BD7F3","Arn"]},"/index/*"]]}]},{"Action":["dynamodb:BatchGetItem","dynamodb:Query","dynamodb:GetItem","dynamodb:Scan","dynamodb:ConditionCheckItem","dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["Notifications87298708","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["Notifications87298708","Arn"]},"/index/*"]]}]},{"Action":["dynamodb:GetRecords","dynamodb:GetShardIterator"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["Notifications87298708","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["Notifications87298708","Arn"]},"/index/*"]]}]},{"Action":["dynamodb:BatchGetItem","dynamodb:Query","dynamodb:GetItem","dynamodb:Scan","dynamodb:ConditionCheckItem","dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":{"Fn::GetAtt":["PushSubscriptions65464CC8","Arn"]}},{"Action":["dynamodb:GetRecords","dynamodb:GetShardIterator"],"Effect":"Allow","Resource":{"Fn::GetAtt":["PushSubscriptions65464CC8","Arn"]}},{"Action":["secretsmanager:GetSecretValue","secretsmanager:DescribeSecret"],"Effect":"Allow","Resource":"arn:aws:secretsmanager:us-east-2:232247293056:secret:hug-harmony/prod/secrets-??????"},{"Action":"execute-api:ManageConnections","Effect":"Allow","Resource":{"Fn::Join":["",["arn:aws:execute-api:us-east-2:232247293056:",{"Ref":"ChatWebSocketApi"},"/*"]]}}],"Version":"2012-10-17"},"policyName":"WebSocketLambdaRoleDefaultPolicyF19D90C5","roles":[{"Ref":"WebSocketLambdaRole0DF09B59"}]}}}}}}},"ConnectHandler":{"id":"ConnectHandler","path":"ChatWebSocketStack-prod/ConnectHandler","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.233.0","metadata":[]},"children":{"Code":{"id":"Code","path":"ChatWebSocketStack-prod/ConnectHandler/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.233.0"},"children":{"Stage":{"id":"Stage","path":"ChatWebSocketStack-prod/ConnectHandler/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.233.0"}},"AssetBucket":{"id":"AssetBucket","path":"ChatWebSocketStack-prod/ConnectHandler/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.233.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"ChatWebSocketStack-prod/ConnectHandler/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-232247293056-us-east-2","s3Key":"5b024fb43899281799a6171f058c52bac1251662e19c48e3bc1e9decc83faed5.zip"},"environment":{"variables":{"CONNECTIONS_TABLE":{"Ref":"ChatConnectionsFC8BD7F3"},"NOTIFICATIONS_TABLE":{"Ref":"Notifications87298708"},"PUSH_SUBSCRIPTIONS_TABLE":{"Ref":"PushSubscriptions65464CC8"},"SECRETS_ARN":"arn:aws:secretsmanager:us-east-2:232247293056:secret:hug-harmony/prod/secrets","SECRETS_NAME":"hug-harmony/prod/secrets","NODE_OPTIONS":"--enable-source-maps","APP_URL":"","INTERNAL_API_KEY":""}},"handler":"ws-connect.handler","memorySize":256,"role":{"Fn::GetAtt":["WebSocketLambdaRole0DF09B59","Arn"]},"runtime":"nodejs18.x","timeout":10}}},"InvokeFcyXBRX02EWa52GlF+ECQiCzDt0fdRUDi4mo4foC5aU=":{"id":"InvokeFcyXBRX02EWa52GlF+ECQiCzDt0fdRUDi4mo4foC5aU=","path":"ChatWebSocketStack-prod/ConnectHandler/InvokeFcyXBRX02EWa52GlF+ECQiCzDt0fdRUDi4mo4foC5aU=","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["ConnectHandler2FFD52D8","Arn"]},"principal":"apigateway.amazonaws.com"}}}}},"DisconnectHandler":{"id":"DisconnectHandler","path":"ChatWebSocketStack-prod/DisconnectHandler","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.233.0","metadata":[]},"children":{"Code":{"id":"Code","path":"ChatWebSocketStack-prod/DisconnectHandler/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.233.0"},"children":{"Stage":{"id":"Stage","path":"ChatWebSocketStack-prod/DisconnectHandler/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.233.0"}},"AssetBucket":{"id":"AssetBucket","path":"ChatWebSocketStack-prod/DisconnectHandler/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.233.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"ChatWebSocketStack-prod/DisconnectHandler/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-232247293056-us-east-2","s3Key":"5b024fb43899281799a6171f058c52bac1251662e19c48e3bc1e9decc83faed5.zip"},"environment":{"variables":{"CONNECTIONS_TABLE":{"Ref":"ChatConnectionsFC8BD7F3"},"NOTIFICATIONS_TABLE":{"Ref":"Notifications87298708"},"PUSH_SUBSCRIPTIONS_TABLE":{"Ref":"PushSubscriptions65464CC8"},"SECRETS_ARN":"arn:aws:secretsmanager:us-east-2:232247293056:secret:hug-harmony/prod/secrets","SECRETS_NAME":"hug-harmony/prod/secrets","NODE_OPTIONS":"--enable-source-maps","APP_URL":"","INTERNAL_API_KEY":""}},"handler":"ws-disconnect.handler","memorySize":256,"role":{"Fn::GetAtt":["WebSocketLambdaRole0DF09B59","Arn"]},"runtime":"nodejs18.x","timeout":10}}},"InvokeFcyXBRX02EWa52GlF+ECQiCzDt0fdRUDi4mo4foC5aU=":{"id":"InvokeFcyXBRX02EWa52GlF+ECQiCzDt0fdRUDi4mo4foC5aU=","path":"ChatWebSocketStack-prod/DisconnectHandler/InvokeFcyXBRX02EWa52GlF+ECQiCzDt0fdRUDi4mo4foC5aU=","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["DisconnectHandlerCB7ED6F7","Arn"]},"principal":"apigateway.amazonaws.com"}}}}},"MessageHandler":{"id":"MessageHandler","path":"ChatWebSocketStack-prod/MessageHandler","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.233.0","metadata":[]},"children":{"Code":{"id":"Code","path":"ChatWebSocketStack-prod/MessageHandler/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.233.0"},"children":{"Stage":{"id":"Stage","path":"ChatWebSocketStack-prod/MessageHandler/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.233.0"}},"AssetBucket":{"id":"AssetBucket","path":"ChatWebSocketStack-prod/MessageHandler/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.233.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"ChatWebSocketStack-prod/MessageHandler/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-232247293056-us-east-2","s3Key":"5b024fb43899281799a6171f058c52bac1251662e19c48e3bc1e9decc83faed5.zip"},"environment":{"variables":{"CONNECTIONS_TABLE":{"Ref":"ChatConnectionsFC8BD7F3"},"NOTIFICATIONS_TABLE":{"Ref":"Notifications87298708"},"PUSH_SUBSCRIPTIONS_TABLE":{"Ref":"PushSubscriptions65464CC8"},"SECRETS_ARN":"arn:aws:secretsmanager:us-east-2:232247293056:secret:hug-harmony/prod/secrets","SECRETS_NAME":"hug-harmony/prod/secrets","NODE_OPTIONS":"--enable-source-maps","APP_URL":"","INTERNAL_API_KEY":""}},"handler":"ws-message.handler","memorySize":512,"role":{"Fn::GetAtt":["WebSocketLambdaRole0DF09B59","Arn"]},"runtime":"nodejs18.x","timeout":30}}},"InvokeFcyXBRX02EWa52GlF+ECQiCzDt0fdRUDi4mo4foC5aU=":{"id":"InvokeFcyXBRX02EWa52GlF+ECQiCzDt0fdRUDi4mo4foC5aU=","path":"ChatWebSocketStack-prod/MessageHandler/InvokeFcyXBRX02EWa52GlF+ECQiCzDt0fdRUDi4mo4foC5aU=","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["MessageHandlerDFBBCD6B","Arn"]},"principal":"apigateway.amazonaws.com"}}}}},"ChatWebSocketApi":{"id":"ChatWebSocketApi","path":"ChatWebSocketStack-prod/ChatWebSocketApi","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnApi","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Api","aws:cdk:cloudformation:props":{"name":"ChatWebSocket-prod","protocolType":"WEBSOCKET","routeSelectionExpression":"$request.body.action"}}},"ConnectIntegration":{"id":"ConnectIntegration","path":"ChatWebSocketStack-prod/ConnectIntegration","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnIntegration","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Integration","aws:cdk:cloudformation:props":{"apiId":{"Ref":"ChatWebSocketApi"},"integrationType":"AWS_PROXY","integrationUri":{"Fn::Join":["",["arn:aws:apigateway:us-east-2:lambda:path/2015-03-31/functions/",{"Fn::GetAtt":["ConnectHandler2FFD52D8","Arn"]},"/invocations"]]}}}},"DisconnectIntegration":{"id":"DisconnectIntegration","path":"ChatWebSocketStack-prod/DisconnectIntegration","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnIntegration","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Integration","aws:cdk:cloudformation:props":{"apiId":{"Ref":"ChatWebSocketApi"},"integrationType":"AWS_PROXY","integrationUri":{"Fn::Join":["",["arn:aws:apigateway:us-east-2:lambda:path/2015-03-31/functions/",{"Fn::GetAtt":["DisconnectHandlerCB7ED6F7","Arn"]},"/invocations"]]}}}},"MessageIntegration":{"id":"MessageIntegration","path":"ChatWebSocketStack-prod/MessageIntegration","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnIntegration","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Integration","aws:cdk:cloudformation:props":{"apiId":{"Ref":"ChatWebSocketApi"},"integrationType":"AWS_PROXY","integrationUri":{"Fn::Join":["",["arn:aws:apigateway:us-east-2:lambda:path/2015-03-31/functions/",{"Fn::GetAtt":["MessageHandlerDFBBCD6B","Arn"]},"/invocations"]]}}}},"ConnectRoute":{"id":"ConnectRoute","path":"ChatWebSocketStack-prod/ConnectRoute","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"ChatWebSocketApi"},"authorizationType":"NONE","routeKey":"$connect","target":{"Fn::Join":["",["integrations/",{"Ref":"ConnectIntegration"}]]}}}},"DisconnectRoute":{"id":"DisconnectRoute","path":"ChatWebSocketStack-prod/DisconnectRoute","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"ChatWebSocketApi"},"routeKey":"$disconnect","target":{"Fn::Join":["",["integrations/",{"Ref":"DisconnectIntegration"}]]}}}},"DefaultRoute":{"id":"DefaultRoute","path":"ChatWebSocketStack-prod/DefaultRoute","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"ChatWebSocketApi"},"routeKey":"$default","target":{"Fn::Join":["",["integrations/",{"Ref":"MessageIntegration"}]]}}}},"joinRoute":{"id":"joinRoute","path":"ChatWebSocketStack-prod/joinRoute","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"ChatWebSocketApi"},"routeKey":"join","target":{"Fn::Join":["",["integrations/",{"Ref":"MessageIntegration"}]]}}}},"typingRoute":{"id":"typingRoute","path":"ChatWebSocketStack-prod/typingRoute","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"ChatWebSocketApi"},"routeKey":"typing","target":{"Fn::Join":["",["integrations/",{"Ref":"MessageIntegration"}]]}}}},"sendMessageRoute":{"id":"sendMessageRoute","path":"ChatWebSocketStack-prod/sendMessageRoute","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"ChatWebSocketApi"},"routeKey":"sendMessage","target":{"Fn::Join":["",["integrations/",{"Ref":"MessageIntegration"}]]}}}},"editMessageRoute":{"id":"editMessageRoute","path":"ChatWebSocketStack-prod/editMessageRoute","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"ChatWebSocketApi"},"routeKey":"editMessage","target":{"Fn::Join":["",["integrations/",{"Ref":"MessageIntegration"}]]}}}},"deleteMessageRoute":{"id":"deleteMessageRoute","path":"ChatWebSocketStack-prod/deleteMessageRoute","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"ChatWebSocketApi"},"routeKey":"deleteMessage","target":{"Fn::Join":["",["integrations/",{"Ref":"MessageIntegration"}]]}}}},"pingRoute":{"id":"pingRoute","path":"ChatWebSocketStack-prod/pingRoute","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"ChatWebSocketApi"},"routeKey":"ping","target":{"Fn::Join":["",["integrations/",{"Ref":"MessageIntegration"}]]}}}},"notificationRoute":{"id":"notificationRoute","path":"ChatWebSocketStack-prod/notificationRoute","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"ChatWebSocketApi"},"routeKey":"notification","target":{"Fn::Join":["",["integrations/",{"Ref":"MessageIntegration"}]]}}}},"heartbeatRoute":{"id":"heartbeatRoute","path":"ChatWebSocketStack-prod/heartbeatRoute","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"ChatWebSocketApi"},"routeKey":"heartbeat","target":{"Fn::Join":["",["integrations/",{"Ref":"MessageIntegration"}]]}}}},"videoInviteRoute":{"id":"videoInviteRoute","path":"ChatWebSocketStack-prod/videoInviteRoute","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"ChatWebSocketApi"},"routeKey":"videoInvite","target":{"Fn::Join":["",["integrations/",{"Ref":"MessageIntegration"}]]}}}},"videoAcceptRoute":{"id":"videoAcceptRoute","path":"ChatWebSocketStack-prod/videoAcceptRoute","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"ChatWebSocketApi"},"routeKey":"videoAccept","target":{"Fn::Join":["",["integrations/",{"Ref":"MessageIntegration"}]]}}}},"videoDeclineRoute":{"id":"videoDeclineRoute","path":"ChatWebSocketStack-prod/videoDeclineRoute","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"ChatWebSocketApi"},"routeKey":"videoDecline","target":{"Fn::Join":["",["integrations/",{"Ref":"MessageIntegration"}]]}}}},"videoEndRoute":{"id":"videoEndRoute","path":"ChatWebSocketStack-prod/videoEndRoute","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"ChatWebSocketApi"},"routeKey":"videoEnd","target":{"Fn::Join":["",["integrations/",{"Ref":"MessageIntegration"}]]}}}},"videoJoinRoute":{"id":"videoJoinRoute","path":"ChatWebSocketStack-prod/videoJoinRoute","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"ChatWebSocketApi"},"routeKey":"videoJoin","target":{"Fn::Join":["",["integrations/",{"Ref":"MessageIntegration"}]]}}}},"WebSocketStage":{"id":"WebSocketStage","path":"ChatWebSocketStack-prod/WebSocketStage","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnStage","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Stage","aws:cdk:cloudformation:props":{"apiId":{"Ref":"ChatWebSocketApi"},"autoDeploy":true,"stageName":"prod"}}},"WebSocketURL":{"id":"WebSocketURL","path":"ChatWebSocketStack-prod/WebSocketURL","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"WebSocketApiEndpoint":{"id":"WebSocketApiEndpoint","path":"ChatWebSocketStack-prod/WebSocketApiEndpoint","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"ConnectionsTableName":{"id":"ConnectionsTableName","path":"ChatWebSocketStack-prod/ConnectionsTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"NotificationsTableName":{"id":"NotificationsTableName","path":"ChatWebSocketStack-prod/NotificationsTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"PushSubscriptionsTableName":{"id":"PushSubscriptionsTableName","path":"ChatWebSocketStack-prod/PushSubscriptionsTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"SecretsArn":{"id":"SecretsArn","path":"ChatWebSocketStack-prod/SecretsArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"ChatWebSocketStack-prod/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"},"children":{"Default":{"id":"Default","path":"ChatWebSocketStack-prod/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.233.0"}}}},"Exports":{"id":"Exports","path":"ChatWebSocketStack-prod/Exports","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"},"children":{"Output{\"Ref\":\"Notifications87298708\"}":{"id":"Output{\"Ref\":\"Notifications87298708\"}","path":"ChatWebSocketStack-prod/Exports/Output{\"Ref\":\"Notifications87298708\"}","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"Output{\"Ref\":\"ChatConnectionsFC8BD7F3\"}":{"id":"Output{\"Ref\":\"ChatConnectionsFC8BD7F3\"}","path":"ChatWebSocketStack-prod/Exports/Output{\"Ref\":\"ChatConnectionsFC8BD7F3\"}","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"Output{\"Ref\":\"PushSubscriptions65464CC8\"}":{"id":"Output{\"Ref\":\"PushSubscriptions65464CC8\"}","path":"ChatWebSocketStack-prod/Exports/Output{\"Ref\":\"PushSubscriptions65464CC8\"}","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"Output{\"Ref\":\"ChatWebSocketApi\"}":{"id":"Output{\"Ref\":\"ChatWebSocketApi\"}","path":"ChatWebSocketStack-prod/Exports/Output{\"Ref\":\"ChatWebSocketApi\"}","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"ChatWebSocketStack-prod/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.233.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"ChatWebSocketStack-prod/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.233.0"}}}},"NotificationStack-prod":{"id":"NotificationStack-prod","path":"NotificationStack-prod","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.233.0"},"children":{"AppSecrets":{"id":"AppSecrets","path":"NotificationStack-prod/AppSecrets","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"NotificationTopic":{"id":"NotificationTopic","path":"NotificationStack-prod/NotificationTopic","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.Topic","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"NotificationStack-prod/NotificationTopic/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnTopic","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::Topic","aws:cdk:cloudformation:props":{"displayName":"Hug Harmony Notifications","topicName":"Notifications-prod"}}}}},"NotificationDLQ":{"id":"NotificationDLQ","path":"NotificationStack-prod/NotificationDLQ","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.Queue","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"NotificationStack-prod/NotificationDLQ/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueue","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::Queue","aws:cdk:cloudformation:props":{"messageRetentionPeriod":1209600,"queueName":"NotificationDLQ-prod","receiveMessageWaitTimeSeconds":20}}}}},"NotificationQueue":{"id":"NotificationQueue","path":"NotificationStack-prod/NotificationQueue","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.Queue","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"NotificationStack-prod/NotificationQueue/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueue","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::Queue","aws:cdk:cloudformation:props":{"queueName":"NotificationQueue-prod","receiveMessageWaitTimeSeconds":20,"redrivePolicy":{"deadLetterTargetArn":{"Fn::GetAtt":["NotificationDLQCDA15FAF","Arn"]},"maxReceiveCount":3},"visibilityTimeout":60}}},"Policy":{"id":"Policy","path":"NotificationStack-prod/NotificationQueue/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.QueuePolicy","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"NotificationStack-prod/NotificationQueue/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueuePolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::QueuePolicy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"sqs:SendMessage","Condition":{"ArnEquals":{"aws:SourceArn":{"Ref":"NotificationTopicEB7A0DF1"}}},"Effect":"Allow","Principal":{"Service":"sns.amazonaws.com"},"Resource":{"Fn::GetAtt":["NotificationQueue36610CC1","Arn"]}}],"Version":"2012-10-17"},"queues":[{"Ref":"NotificationQueue36610CC1"}]}}}}},"NotificationStackprodNotificationTopic77CA8548":{"id":"NotificationStackprodNotificationTopic77CA8548","path":"NotificationStack-prod/NotificationQueue/NotificationStackprodNotificationTopic77CA8548","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.Subscription","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"NotificationStack-prod/NotificationQueue/NotificationStackprodNotificationTopic77CA8548/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnSubscription","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::Subscription","aws:cdk:cloudformation:props":{"endpoint":{"Fn::GetAtt":["NotificationQueue36610CC1","Arn"]},"protocol":"sqs","rawMessageDelivery":false,"topicArn":{"Ref":"NotificationTopicEB7A0DF1"}}}}}}}},"NotificationLambdaRole":{"id":"NotificationLambdaRole","path":"NotificationStack-prod/NotificationLambdaRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.233.0","metadata":[]},"children":{"ImportNotificationLambdaRole":{"id":"ImportNotificationLambdaRole","path":"NotificationStack-prod/NotificationLambdaRole/ImportNotificationLambdaRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"Resource":{"id":"Resource","path":"NotificationStack-prod/NotificationLambdaRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"NotificationStack-prod/NotificationLambdaRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"NotificationStack-prod/NotificationLambdaRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["secretsmanager:GetSecretValue","secretsmanager:DescribeSecret"],"Effect":"Allow","Resource":"arn:aws:secretsmanager:us-east-2:232247293056:secret:hug-harmony/prod/secrets-??????"},{"Action":["dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:aws:dynamodb:us-east-2:232247293056:table/",{"Fn::ImportValue":"ChatWebSocketStack-prod:ExportsOutputRefNotifications872987081051AE19"}]]}},{"Action":["dynamodb:BatchGetItem","dynamodb:Query","dynamodb:GetItem","dynamodb:Scan","dynamodb:ConditionCheckItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:aws:dynamodb:us-east-2:232247293056:table/",{"Fn::ImportValue":"ChatWebSocketStack-prod:ExportsOutputRefChatConnectionsFC8BD7F3444AD0F2"}]]}},{"Action":["dynamodb:GetRecords","dynamodb:GetShardIterator"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:aws:dynamodb:us-east-2:232247293056:table/",{"Fn::ImportValue":"ChatWebSocketStack-prod:ExportsOutputRefChatConnectionsFC8BD7F3444AD0F2"}]]}},{"Action":["dynamodb:BatchGetItem","dynamodb:Query","dynamodb:GetItem","dynamodb:Scan","dynamodb:ConditionCheckItem","dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:aws:dynamodb:us-east-2:232247293056:table/",{"Fn::ImportValue":"ChatWebSocketStack-prod:ExportsOutputRefPushSubscriptions65464CC820BA4F62"}]]}},{"Action":["dynamodb:GetRecords","dynamodb:GetShardIterator"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:aws:dynamodb:us-east-2:232247293056:table/",{"Fn::ImportValue":"ChatWebSocketStack-prod:ExportsOutputRefPushSubscriptions65464CC820BA4F62"}]]}},{"Action":"execute-api:ManageConnections","Effect":"Allow","Resource":"arn:aws:execute-api:us-east-2:232247293056:*/*/@connections/*"},{"Action":["sqs:ReceiveMessage","sqs:ChangeMessageVisibility","sqs:GetQueueUrl","sqs:DeleteMessage","sqs:GetQueueAttributes"],"Effect":"Allow","Resource":{"Fn::GetAtt":["NotificationQueue36610CC1","Arn"]}}],"Version":"2012-10-17"},"policyName":"NotificationLambdaRoleDefaultPolicy07D18877","roles":[{"Ref":"NotificationLambdaRole8517A721"}]}}}}}}},"NotificationsTable":{"id":"NotificationsTable","path":"NotificationStack-prod/NotificationsTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.TableBase","version":"2.233.0","metadata":[]}},"ConnectionsTable":{"id":"ConnectionsTable","path":"NotificationStack-prod/ConnectionsTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.TableBase","version":"2.233.0","metadata":[]}},"PushSubscriptionsTable":{"id":"PushSubscriptionsTable","path":"NotificationStack-prod/PushSubscriptionsTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.TableBase","version":"2.233.0","metadata":[]}},"NotificationProcessor":{"id":"NotificationProcessor","path":"NotificationStack-prod/NotificationProcessor","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.233.0","metadata":[]},"children":{"Code":{"id":"Code","path":"NotificationStack-prod/NotificationProcessor/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.233.0"},"children":{"Stage":{"id":"Stage","path":"NotificationStack-prod/NotificationProcessor/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.233.0"}},"AssetBucket":{"id":"AssetBucket","path":"NotificationStack-prod/NotificationProcessor/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.233.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"NotificationStack-prod/NotificationProcessor/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-232247293056-us-east-2","s3Key":"1b40491ab1d22c6fba7782b2de951ab951a1bfa7dcbdfe3fe54ba818017d9d03.zip"},"environment":{"variables":{"NOTIFICATIONS_TABLE":{"Fn::ImportValue":"ChatWebSocketStack-prod:ExportsOutputRefNotifications872987081051AE19"},"CONNECTIONS_TABLE":{"Fn::ImportValue":"ChatWebSocketStack-prod:ExportsOutputRefChatConnectionsFC8BD7F3444AD0F2"},"PUSH_SUBSCRIPTIONS_TABLE":{"Fn::ImportValue":"ChatWebSocketStack-prod:ExportsOutputRefPushSubscriptions65464CC820BA4F62"},"WEBSOCKET_API_ENDPOINT":{"Fn::Join":["",["https://",{"Fn::ImportValue":"ChatWebSocketStack-prod:ExportsOutputRefChatWebSocketApi67FC4780"},".execute-api.us-east-2.amazonaws.com/prod"]]},"SECRETS_NAME":"hug-harmony/prod/secrets","NODE_OPTIONS":"--enable-source-maps"}},"functionName":"NotificationProcessor-prod","handler":"notification-processor.handler","memorySize":512,"reservedConcurrentExecutions":10,"role":{"Fn::GetAtt":["NotificationLambdaRole8517A721","Arn"]},"runtime":"nodejs18.x","timeout":30}}},"SqsEventSource:NotificationStackprodNotificationQueue700785FC":{"id":"SqsEventSource:NotificationStackprodNotificationQueue700785FC","path":"NotificationStack-prod/NotificationProcessor/SqsEventSource:NotificationStackprodNotificationQueue700785FC","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.EventSourceMapping","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"NotificationStack-prod/NotificationProcessor/SqsEventSource:NotificationStackprodNotificationQueue700785FC/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnEventSourceMapping","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::EventSourceMapping","aws:cdk:cloudformation:props":{"batchSize":10,"eventSourceArn":{"Fn::GetAtt":["NotificationQueue36610CC1","Arn"]},"functionName":{"Ref":"NotificationProcessorE91924AA"},"functionResponseTypes":["ReportBatchItemFailures"],"maximumBatchingWindowInSeconds":5}}}}}}},"DLQAlarm":{"id":"DLQAlarm","path":"NotificationStack-prod/DLQAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"NotificationStack-prod/DLQAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmDescription":"Alert when there are messages in the notification DLQ","alarmName":"NotificationDLQ-Messages-prod","comparisonOperator":"GreaterThanOrEqualToThreshold","dimensions":[{"name":"QueueName","value":{"Fn::GetAtt":["NotificationDLQCDA15FAF","QueueName"]}}],"evaluationPeriods":1,"metricName":"ApproximateNumberOfMessagesVisible","namespace":"AWS/SQS","period":300,"statistic":"Maximum","threshold":1,"treatMissingData":"notBreaching"}}}}},"ProcessorErrorAlarm":{"id":"ProcessorErrorAlarm","path":"NotificationStack-prod/ProcessorErrorAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"NotificationStack-prod/ProcessorErrorAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmDescription":"Alert when notification processor has errors","alarmName":"NotificationProcessor-Errors-prod","comparisonOperator":"GreaterThanOrEqualToThreshold","dimensions":[{"name":"FunctionName","value":{"Ref":"NotificationProcessorE91924AA"}}],"evaluationPeriods":1,"metricName":"Errors","namespace":"AWS/Lambda","period":300,"statistic":"Sum","threshold":5,"treatMissingData":"notBreaching"}}}}},"NotificationTopicArn":{"id":"NotificationTopicArn","path":"NotificationStack-prod/NotificationTopicArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"NotificationTopicName":{"id":"NotificationTopicName","path":"NotificationStack-prod/NotificationTopicName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"NotificationQueueUrl":{"id":"NotificationQueueUrl","path":"NotificationStack-prod/NotificationQueueUrl","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"NotificationQueueArn":{"id":"NotificationQueueArn","path":"NotificationStack-prod/NotificationQueueArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"NotificationDLQUrl":{"id":"NotificationDLQUrl","path":"NotificationStack-prod/NotificationDLQUrl","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"NotificationProcessorArn":{"id":"NotificationProcessorArn","path":"NotificationStack-prod/NotificationProcessorArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"NotificationStack-prod/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"},"children":{"Default":{"id":"Default","path":"NotificationStack-prod/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.233.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"NotificationStack-prod/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.233.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"NotificationStack-prod/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.233.0"}}}},"ChimeStack-prod":{"id":"ChimeStack-prod","path":"ChimeStack-prod","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.233.0"},"children":{"VideoRooms":{"id":"VideoRooms","path":"ChimeStack-prod/VideoRooms","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"ChimeStack-prod/VideoRooms/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"meetingId","attributeType":"S"},{"attributeName":"appointmentId","attributeType":"S"},{"attributeName":"externalMeetingId","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","globalSecondaryIndexes":[{"indexName":"AppointmentIndex","keySchema":[{"attributeName":"appointmentId","keyType":"HASH"}],"projection":{"projectionType":"ALL"}},{"indexName":"ExternalMeetingIndex","keySchema":[{"attributeName":"externalMeetingId","keyType":"HASH"}],"projection":{"projectionType":"ALL"}}],"keySchema":[{"attributeName":"meetingId","keyType":"HASH"}],"tableName":"VideoRooms-prod","timeToLiveSpecification":{"attributeName":"ttl","enabled":true}}}},"ScalingRole":{"id":"ScalingRole","path":"ChimeStack-prod/VideoRooms/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}}}},"VideoRoomsTableName":{"id":"VideoRoomsTableName","path":"ChimeStack-prod/VideoRoomsTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"ChimeStack-prod/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"},"children":{"Default":{"id":"Default","path":"ChimeStack-prod/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.233.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"ChimeStack-prod/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.233.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"ChimeStack-prod/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.233.0"}}}},"PaymentSchedulerStack-prod":{"id":"PaymentSchedulerStack-prod","path":"PaymentSchedulerStack-prod","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.233.0"},"children":{"AppSecrets":{"id":"AppSecrets","path":"PaymentSchedulerStack-prod/AppSecrets","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"PaymentSchedulerLambdaRole":{"id":"PaymentSchedulerLambdaRole","path":"PaymentSchedulerStack-prod/PaymentSchedulerLambdaRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.233.0","metadata":[]},"children":{"ImportPaymentSchedulerLambdaRole":{"id":"ImportPaymentSchedulerLambdaRole","path":"PaymentSchedulerStack-prod/PaymentSchedulerLambdaRole/ImportPaymentSchedulerLambdaRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"Resource":{"id":"Resource","path":"PaymentSchedulerStack-prod/PaymentSchedulerLambdaRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"PaymentSchedulerStack-prod/PaymentSchedulerLambdaRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"PaymentSchedulerStack-prod/PaymentSchedulerLambdaRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["secretsmanager:GetSecretValue","secretsmanager:DescribeSecret"],"Effect":"Allow","Resource":"arn:aws:secretsmanager:us-east-2:232247293056:secret:hug-harmony/prod/secrets-??????"}],"Version":"2012-10-17"},"policyName":"PaymentSchedulerLambdaRoleDefaultPolicy839A8558","roles":[{"Ref":"PaymentSchedulerLambdaRole0BFC6C61"}]}}}}}}},"PaymentProcessorHandler":{"id":"PaymentProcessorHandler","path":"PaymentSchedulerStack-prod/PaymentProcessorHandler","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.233.0","metadata":[]},"children":{"Code":{"id":"Code","path":"PaymentSchedulerStack-prod/PaymentProcessorHandler/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.233.0"},"children":{"Stage":{"id":"Stage","path":"PaymentSchedulerStack-prod/PaymentProcessorHandler/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.233.0"}},"AssetBucket":{"id":"AssetBucket","path":"PaymentSchedulerStack-prod/PaymentProcessorHandler/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.233.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"PaymentSchedulerStack-prod/PaymentProcessorHandler/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-232247293056-us-east-2","s3Key":"e61b6358bd35c2bb1c1d471189c27b06d2bd8b6a60507f318ec75ba986429cca.zip"},"environment":{"variables":{"STAGE":"prod","APP_URL":"","CRON_SECRET":"","SECRETS_NAME":"hug-harmony/prod/secrets","NODE_OPTIONS":"--enable-source-maps"}},"handler":"payment-processor.handler","memorySize":512,"role":{"Fn::GetAtt":["PaymentSchedulerLambdaRole0BFC6C61","Arn"]},"runtime":"nodejs18.x","timeout":300}}}}},"WeeklyPaymentProcessing":{"id":"WeeklyPaymentProcessing","path":"PaymentSchedulerStack-prod/WeeklyPaymentProcessing","constructInfo":{"fqn":"aws-cdk-lib.aws_events.Rule","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"PaymentSchedulerStack-prod/WeeklyPaymentProcessing/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_events.CfnRule","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Events::Rule","aws:cdk:cloudformation:props":{"description":"Triggers payment processing every Monday at 3:00 PM UTC","name":"PaymentProcessing-Weekly-prod","scheduleExpression":"cron(0 15 ? * MON *)","state":"ENABLED","targets":[{"id":"Target0","arn":{"Fn::GetAtt":["PaymentProcessorHandlerBCE6CC2B","Arn"]},"retryPolicy":{"maximumRetryAttempts":2}}]}}},"AllowEventRulePaymentSchedulerStackprodPaymentProcessorHandlerB146C0AE":{"id":"AllowEventRulePaymentSchedulerStackprodPaymentProcessorHandlerB146C0AE","path":"PaymentSchedulerStack-prod/WeeklyPaymentProcessing/AllowEventRulePaymentSchedulerStackprodPaymentProcessorHandlerB146C0AE","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["PaymentProcessorHandlerBCE6CC2B","Arn"]},"principal":"events.amazonaws.com","sourceArn":{"Fn::GetAtt":["WeeklyPaymentProcessingED011536","Arn"]}}}}}},"DailyConfirmationCheck":{"id":"DailyConfirmationCheck","path":"PaymentSchedulerStack-prod/DailyConfirmationCheck","constructInfo":{"fqn":"aws-cdk-lib.aws_events.Rule","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"PaymentSchedulerStack-prod/DailyConfirmationCheck/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_events.CfnRule","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Events::Rule","aws:cdk:cloudformation:props":{"description":"Checks for appointments needing confirmation daily at 9:00 AM UTC","name":"ConfirmationCheck-Daily-prod","scheduleExpression":"cron(0 9 * * ? *)","state":"ENABLED","targets":[{"id":"Target0","arn":{"Fn::GetAtt":["PaymentProcessorHandlerBCE6CC2B","Arn"]},"retryPolicy":{"maximumRetryAttempts":2}}]}}},"AllowEventRulePaymentSchedulerStackprodPaymentProcessorHandlerB146C0AE":{"id":"AllowEventRulePaymentSchedulerStackprodPaymentProcessorHandlerB146C0AE","path":"PaymentSchedulerStack-prod/DailyConfirmationCheck/AllowEventRulePaymentSchedulerStackprodPaymentProcessorHandlerB146C0AE","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["PaymentProcessorHandlerBCE6CC2B","Arn"]},"principal":"events.amazonaws.com","sourceArn":{"Fn::GetAtt":["DailyConfirmationCheck5CD47085","Arn"]}}}}}},"AutoConfirmCheck":{"id":"AutoConfirmCheck","path":"PaymentSchedulerStack-prod/AutoConfirmCheck","constructInfo":{"fqn":"aws-cdk-lib.aws_events.Rule","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"PaymentSchedulerStack-prod/AutoConfirmCheck/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_events.CfnRule","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Events::Rule","aws:cdk:cloudformation:props":{"description":"Auto-confirms appointments after 48 hours of no response","name":"AutoConfirm-Check-prod","scheduleExpression":"rate(6 hours)","state":"ENABLED","targets":[{"id":"Target0","arn":{"Fn::GetAtt":["PaymentProcessorHandlerBCE6CC2B","Arn"]},"retryPolicy":{"maximumRetryAttempts":2}}]}}},"AllowEventRulePaymentSchedulerStackprodPaymentProcessorHandlerB146C0AE":{"id":"AllowEventRulePaymentSchedulerStackprodPaymentProcessorHandlerB146C0AE","path":"PaymentSchedulerStack-prod/AutoConfirmCheck/AllowEventRulePaymentSchedulerStackprodPaymentProcessorHandlerB146C0AE","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["PaymentProcessorHandlerBCE6CC2B","Arn"]},"principal":"events.amazonaws.com","sourceArn":{"Fn::GetAtt":["AutoConfirmCheck2D7EACC9","Arn"]}}}}}},"PaymentProcessorLambdaArn":{"id":"PaymentProcessorLambdaArn","path":"PaymentSchedulerStack-prod/PaymentProcessorLambdaArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"WeeklyPaymentRuleArn":{"id":"WeeklyPaymentRuleArn","path":"PaymentSchedulerStack-prod/WeeklyPaymentRuleArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"PaymentSchedulerStack-prod/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"},"children":{"Default":{"id":"Default","path":"PaymentSchedulerStack-prod/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.233.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"PaymentSchedulerStack-prod/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.233.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"PaymentSchedulerStack-prod/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.233.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"}}}}}